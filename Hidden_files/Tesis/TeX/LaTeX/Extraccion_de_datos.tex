\chapter{Extracción de datos}

La fuente de información de donde obtuvimos los datos utilizados son las páginas de los horarios de la Facultad. En la \figurename{~\ref{pagFC}} se muestra un ejemplo de dichas páginas. Cada página contiene toda la posible información de los grupos de una materia, un semestre y una carrera. Cabe mencionar que sólo tomamos en cuenta la información de las carreras del Departamento de Matemáticas, las cuales son: Actuaría, Ciencias de la Computación, Matemáticas y Matemáticas Aplicadas.

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{Fuente_de_info} %scale = 0.5
%\url{http://www.fciencias.unam.mx/docencia/horarios/20201/217/607} %%URL de la imagen
\caption[\textit{Página de horarios de la Facultad de Ciencias}]{\textit{Página de horarios de la Facultad de Ciencias: Muestra la información de los horarios de la materia ``Lenguajes de Programación y sus Paradigmas'', de la carrera de Matemáticas, plan 1983, del semestre 2020-1.}}\label{pagFC}
\end{figure}

La información que se puede extraer de las páginas mencionadas es: \textit{nombre de profesores, nombre de ayudantes, salón, horario, plan, carrera, año, número de semestre, materia, semestre de la materia, tipo de materia} e \textit{información de exámenes finales}.


\section{Estructura de las URL's}

Al iniciar la búsqueda de información notamos que las URL's de las páginas web de los horarios de la Facultad tenían una estructura similar. Ésto nos permitió poder realizar la búsqueda de la información de una manera automática y mucho más rápida. Observamos que la estructura que siguen las URL's mencionadas es la siguiente:

\begin{center}
\textit{\textbf{http://www.fciencias.unam.mx/docencia/horarios/a/b/c}}
\end{center}

Se tiene una raíz común para todas las páginas y al final se tienen tres números los cuales representan:

\begin{itemize}
\item[ ] \textit{\textbf{a}} = año y número de semestre

\item[ ] \textit{\textbf{b}} = clave del plan de estudios

\item[ ] \textit{\textbf{c}} = número de materia
\end{itemize}

Para este trabajo tomamos en cuenta sólo los planes de estudio vigentes hasta el semestre 2020-1. Es decir, tomamos todos los planes mostrados en la tabla \tablename{~\ref{PlanesEstudio}}, salvo el plan 1972 de Actuaría (el cual ya no está vigente). Dicha tabla muestra los planes de estudio de cada carrera con su clave correspondiente.

\begin{table}[h]
\centering
\begin{tabular}{|c|c|}
 \hline 
  \textbf{PLAN} & \textbf{CLAVE} \\ 
 \hline 
 \multicolumn{2}{|c|}{Actuaría} \\ 
 \hline 
 1972 & 214 \\ 
 \hline 
 2000 & 119 \\ 
 \hline 
 2006 & 1176 \\ 
 \hline 
 2015 & 2017 \\ 
 \hline 
 \multicolumn{2}{|c|}{Ciencias de la Computación} \\ 
 \hline 
 1994 & 218 \\ 
 \hline 
 2013 & 1556 \\ 
 \hline 
 \multicolumn{2}{|c|}{Matemáticas} \\ 
 \hline 
 1983 & 217 \\ 
 \hline 
 \multicolumn{2}{|c|}{Matemáticas Aplicadas} \\ 
 \hline 
 2017 & 2055 \\ 
 \hline 
 \end{tabular}
\caption[\textit{Planes de estudio por carrera con clave}]{\textit{Planes de estudio por carrera con clave: La clave de cada plan de estudios se sutituye en \textbf{b} en la estructura de las URL's de las páginas de la Facultad.}}\label{PlanesEstudio}
\end{table}

Una vez identificada la estructura de las URL's pudimos realizar la búsqueda de información de manera automatizada. Originalmente decidimos que $c \in \{1,2,3, \ldots, 10 000\}$. Después hicimos una función que genera una matriz llamada \textit{mat\_posibles\_url}. La función sólo guarda las URL's que si existen. La descripción de lo que contiene cada columna de la matriz \textit{mat\_posibles\_url} la podemos ver en la \tablename{~\ref{matPosiblesURL}}. Finalmente al obtener dicha matriz, observamos que el valor máximo que toma $c$ es 991, por lo que redujimos su conjunto de posibles valores y definimos $c \in \{1, \ldots, 1 000\}$.

\dfNmatrizChica %%Tabla con la información de la matriz chica

Decidimos buscar información en 25 semestres, del 2008-1 al 2020-1. Al multiplicar el número de semestres por los posibles valores de \textbf{c} $(25 \times \textbf{c})$ obtuvimos un número cercano a $25,000$. Este valor es una aproximación del número de posibles URL's con información de los horarios de la Facultad. Notemos que no estamos contando los planes de estudio, de ser así el número supera las $170,000$ posibles URL's. Deseamos obtener información de cada una de esas páginas. Obtener dicha información ingresando a cada una de las páginas es complicado por lo que es necesario hacerlo de manera automatizada. Para extraer los datos de las páginas de la Facultad utilizamos una aplicación de \textit{Google Chrome} llamada \textit{SelectorGadget}. La cual explicamos en la siguiente sección.

\section{Extracción de datos con la aplicación SelectorGadget}

La aplicación \textit{SelectorGadget} permite seleccionar la información deseada y arroja una sección del código CSS de una página web. Dicho código se introduce en \textit{R} para poder seleccionar y descargar la información deseada. A continuación veremos los pasos que se deben de seguir para obtener el código CSS de la información seleccionada. Los colores y señalizaciones mencionados hacen referencia a la \figurename{~\ref{appSelectorGadget}}. En dicha figura podemos ver un ejemplo del funcionamiento de la aplicación.

\begin{enumerate}
\item Presionar el ícono de la aplicación, el cual es una lupa (señalado por la flecha roja).

\item Seleccionar la información deseada (en color verde).

\item La aplicación automáticamente selecciona todas las entradas que coindiciden (en color amarillo).

\item En caso de que se haya seleccionado más información de la deseada entonces dar click sobre la información excedente (en color rojo).

\item  En el cuadro de texto, la aplicación arroja la sección del código CSS correspondiente a la información seleccionada. También muestra el número de entradas selecionadas (en óvalos rojos).
\end{enumerate}


\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{SelectorGadget} %scale = 0.65
%\url{http://www.fciencias.unam.mx/docencia/horarios/20181/2017/625} %%URL de la imagen
\caption[\textit{Aplicación SelectorGadget}]{\textit{Aplicación SelectorGadget: En esta figura se muestra cómo se ve una página de horarios de la Facultad al usar la aplicación SelectorGadget mientras se selecciona la información que deseamos extraer.}}\label{appSelectorGadget}
\end{figure}

En el ejemplo mostrado en la \figurename{~\ref{appSelectorGadget}},se seleccionaron 15 entradas correspondientes a los nombres de los profesores en una página con la información de la materia \textit{Probabilidad I}, en el plan 2015 de Actuaría. Los pasos a seguir son los mismos sin importar la información que se desea obtener, lo único que cambia es el código CSS que arroja la aplicación.


\section{Tipos de grupos de las páginas web de la Facultad de Ciencias} \label{TiposDeGpos}

Al inicio encontramos tres tipos de grupos dentro de las páginas de horarios de la Facultad. Cada uno con información similar, pero hicimos la separación de acuerdo a sus diferencias. Cabe mencionar que en este trabajo consideramos como semestre actual al semestre $2020-1$. En todos los grupos se puede encontrar la información del nombre de profesor, nombre del o de los ayudantes, salón, horario y el número de alumnos inscritos en el grupo.

\begin{enumerate}
\item[a)] En el grupo \textbf{A} se tienen las páginas correspondientes al semestre actual. Este grupo tiene la información del número de lugares diponibles por salón, pero no contiene la información de los exámenes finales, porque se considera que el semestres aún está en curso y aún no termina. En la \figurename{~\ref{GpoA}} podemos ver un ejemplo de este tipo de grupo.

\begin{figure}[H]
\centering
\includegraphics[scale = 0.8]{GrupoA} %width=\textwidth
%\url{http://www.fciencias.unam.mx/docencia/horarios/20201/2017/1707}
\caption[\textit{Tipo de grupo A}]{\textit{Tipo de grupo A: Correspondiente al semestre en curso que aún no finaliza.}}\label{GpoA}
\end{figure}


\item[b)] En el grupo \textbf{B} se tienen las páginas correspondientes a semestres entre el $2018-2$ y el semestre anterior al actual, con respecto al año en curso. En este tipo de grupos se tiene información del número de lugares disponibles por salón y la información de los exámenes finales, porque son semestres que ya finalizaron. En la figura \figurename{~\ref{GpoB}} encontramos un ejemplo de este tipo de grupo.

\begin{figure}[H]
\centering
\includegraphics[scale = 0.8]{GrupoB} %width=\textwidth
%\url{http://www.fciencias.unam.mx/docencia/horarios/20182/217/625}
\caption[\textit{Tipo de grupo B}]{\textit{Tipo de grupo B: Correspondiente a semestres ya finalizados, posteriores al semestre 2018-2.}}\label{GpoB}
\end{figure}

\item[c)] En el grupo \textbf{C} se tienen las páginas correspondientes a semestres anteriores al $2018-1$, incluyéndolo. Este tipo de grupos tiene información de los exámenes finales, pero no contiene la información del número de lugares disponibles por salón. En la figura \figurename{~\ref{GpoC}} podemos ver un ejemplo.

\begin{figure}[H]
\centering
\includegraphics[scale = 0.8]{GrupoC} %width=\textwidth
%\url{http://www.fciencias.unam.mx/docencia/horarios/20181/1556/399}
\caption[\textit{Tipo de grupo C}]{\textit{Tipo de grupo C: Correspondiente a semestres ya finalizados, anteriores al semestre 2018-1, incluyéndolo.}}\label{GpoC}
\end{figure}
\end{enumerate}


\section{Limpieza de base de datos}

Se puede encontrar que, en general, cuando uno realiza la limpieza de datos se hace el 80\% del análisis de los datos. Es en ese momento en donde se encuentran los diferentes problemas que se pueden presentar. Se pueden encontrar posibles errores en los datos, información incompleta, o valores poco comunes de acuerdo al comportamiento observado. Los problemas que encontramos al limpiar los datos se desglosan en las siguientes subsecciones.

\input{ED_falta_de_info} %%Subsección %%To include subfiles in to a subfiles use \input{name_of_file}
\input{ED_info_repetida} %%Subsección
\input{ED_otros_problemas_extraer_info} %%Subsección

\section{Matrices de datos}

Una vez que se realizó el proceso de la limpieza de los datos obtenidos, éstos se guardaron, por semestre, en matrices llamadas \textit{m\_grande}. Los nombres de sus columnas con su respectiva explicación y posibles valores, se muestran en la siguiente tabla:

\dfNmatrizGrande %%Tabla con la información de la matriz grande

La columna \textit{Cambios}, va a guardar todos los cambios que ha tenido cada grupo. El significado de los números que pueden aparecer en esa columna se explican a continuación:

\begin{enumerate}
\item[(1)] Grupos con detalles particulares.

\item[(2)] Se anotaron los días en los que se imparte la materia, en la columna \textit{Horario}, por ejemplo cuando había conflicto debido a que el profesor impartía más de una materia a la misma hora, al revisar el caso se encontró que los días en los que se impartía la clase era distinto.

\item[(3)] Se eliminaron los grupos repetidos, al juntar la información en un mismo grupo.

\item[(4)] Páginas que no tienen información del salón.

\item[(5)] Actualización del número de materia por cambio de nombre o agrupamiento de materias.
\end{enumerate}
