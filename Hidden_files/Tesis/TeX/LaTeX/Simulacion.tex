\chapter{Simulación}

La simulación es un proceso que nos permite estudiar el comportamiento de un sistema complejo que es muy difícil de examinar de manera analítica. Nos ayuda a determinar de manera empírica las probabilidades de ciertos eventos. La simulación nos permite experimentar con diversos supuestos que podrían ser muy costosos de realizar. Las áreas en las que se utiliza la simulación como herramienta diaria son por ejemplo en biología, estadística, medicina, química, matemáticas, investigación de operaciones, física, ingeniería o en las ciencias sociales.

Algunos ejemplos de su aplicación van desde simular el lanzamiento de una moneda justa, hasta la simulación de colisiones de átomos en un acelerador de partículas. Se utiliza para todo tipo de propósitos, por ejemplo para poder realizar predicciones en base a datos históricos o enseñar a los pilotos a volar un avión sin poner en riesgo a la población al volar el avión real.

Actualmente se combinan diferentes metodologías de simulación con el software disponible, el análisis de sensibilidad y la optimización estocástica para poder obtener un mejor resultado al momento de simular sistemas que se hacen cada vez más complejos como las redes neuronales.

A lo largo de este capítulo explicaremos el proceso que seguimos para obtener la asignación de los horarios para cada materia con su respectivo profesor.

\section{Funciones hechas en R}

El diagrama de flujo de la función \textbf{gen\_asignacion} se puede ver en la figura \ref{DF_genAsig}.

\begin{figure}[H]
\centering
\includegraphics[scale = 0.7]{diagrama_flujo} %width=\textwidth
\caption{\textit{Diagrama de flujo de la función \textbf{gen\_asignacion}}}\label{DF_genAsig}
\end{figure}


\begin{itemize}
\item \textit{posibles\_url}

\item \textit{gen\_m\_grande}

\item \textit{gen\_m\_grande\_total}

\item \textit{gen\_esqueleto: } Función que genera esqueletos la cual carga la función \textit{simula\_grupos} y ésta a su vez carga la función \textit{estima\_grupos}.

\item \textit{gen\_solicitudes}

\item \textit{gen\_asignacion}

\item \textit{gen\_simula\_alumnos}

\item \textit{gen\_simula\_tamano\_grupo}
\end{itemize}

\input{Sim_obtencionq1q2} %%Subsección %%To include subfiles in to a subfiles use \input{name_of_file}

\input{Sim_demanda_alumnos}

\section{Simulación de tamaño de grupos}

En esta sección vamos a explicar cómo hicimos la simulación del tamaño de grupos. Vamos a definir al tamaño de un grupo como el número de alumnos que va a tener cada grupo.

Hicimos una función en \textit{R} que realiza los siguientes pasos:

\begin{enumerate}
\item Definir \textit{m\_grande\_2015} la cual es una submatriz de \textit{m\_grande\_total} con los datos de los semestres del 2015-1 al 2020-1.

\item Obtener, de \textit{m\_grande\_2015}, la información del número de alumnos que ha tenido un profesor.

\item Tomar el mínimo $(a)$ y el máximo $(b)$ de esos datos.

\item Generar un número aleatorio con distribución uniforme en ese intervalo con la función \verb@runif(1,min = a, max = b)@ en \textit{R}.

\item Redondear el número aleatorio con la función \verb@ceiling()@ en \textit{R}.

\item Regresa el número redondeado.
\end{enumerate}

Con este procedimiento simulamos el tamaño de los grupos con respecto a los profesores. En la vida real cuando un alumno decide inscribirse a una materia a cierta hora, la decisión que toma para elegir el grupo al que se quiere inscribir es el profesor con el que le gustaría tomar esa materia a esa hora. Decidimos realizar de esta manera la simulación porque queremos que el número de alumnos de cada grupo dependa de los profesores y no de la distribución general que tiene el tamaño de los grupos (ver \ref{DitribTamGpos}).

\input{Sim_info_solicitudes}

\input{Sim_solicitudes}



\section{Simulación de esqueletos}

Matriz de 2 columnas (Materia-Horario). En el renglón $i$ se tiene la información de cada grupo simulado para \textit{t+1}.

Se utiliza un matriz auxiliar de 3 columnas (Materia-Horario-Demanda\_Alum). En el renglón $i$ se tiene la información del número de alumnos simulados para la hora y materia correspondientes.

\begin{figure}[H]
\centering
\includegraphics[scale = 0.8]{Ej_esqueleto_20202} %width=\textwidth
\caption{\textit{Ejemplo de esqueleto para el semestre 2020-2}}\label{esqueleto20202}
\end{figure}

\section{Calificación de esqueletos de horario}

\begin{eqnarray*}
L_{materia} &=& -1 \,\,\,\,\,\,  \text{por cada materia no impartida}\\
x &=& \text{promedio}\\
y &=& \text{cupo}\\
L_{dif\_p\_c} (x,y) &=& \begin{cases}
    \dfrac{a}{190} (x-y)  & \quad \text{si } x<y\\
    - \dfrac{b}{190} (x-y)  & \quad \text{si } x\geqslant y
  \end{cases}\\
a &=& 0.5\\
b &=& 0.8\\
L_{categoria}^{1} (mat,solicitud) &=& -c(categoria - 1)\\
L_{categoria}^{2} (mat,solicitud) &=& -c_{1}(categoria)
\end{eqnarray*}

Al momento de simular las solicitudes de materias para los profesores suponemos que la que está en primer lugar es la materia que más quiere dar, en segundo lugar, la segunda que quiere dar.

Primero asignar grupos a los profesores de tiempo completo. Después asignar grupos faltantes a los profesores de asignatura.

$L_{materia}$ es la penalización por no tener en el esqueleto una materia que necesitamos.

$L_{dif\_p\_c}$ es la penalización en la asignación de salones. Se tiene un grupo de tamaño $x$ y un salón con capacidad $y$. Se penaliza con $\dfrac{a}{190}$ veces la diferencia entre $x$ y $y$ cuando el tamaño del grupo es menor a la capacidad del salón y se penaliza con $-\dfrac{b}{190}$ veces la diferencia entre $x$ y $y$ cuando el tamaño del grupo es mayor a la capacidad del salón.

El esqueleto depende de la demanda de alumnos y de las solicitudes de los profesores.

Primero se asignan materias a los profesores de tiempo completo y después a los de asignatura.

Los profesores de asignatura pueden quedarse sin materias asignadas.

Penalizaciones:

\begin{enumerate}
\item Si algún profesor pidió alguna materia y no se la dieron.

\item Si hay alumnos que necesitan una clase a alguna hora y no existe profesor que la imparta.

\item Con $\alpha \times num\_alumnos\_faltantes$ por cada alumno que te faltó en cada hora-materia que tenías que dar. $\alpha > 0$

\item Con $\beta \times num\_alumnos\_sobrantes$ por cada alumno que te pasaste en cada hora-materia que tenías que dar. $\beta > 0$

\end{enumerate}

Queremos el esqueleto con el menor valor en $\alpha + \beta$

Con esto se obtiene un nuevo esqueleto.


\section{Generación de asignaciones}

Matriz de 3 columnas (Materia-Horario-Profesor), la cual tiene la información de las asignaciones. A cada renglón de la matriz de esqueletos se agrega un profesor. Se genera con el esqueleto obtenido del proceso del AG y de las solicitudes de los profesores.

\subsection{Calificación de asignaciones de grupo}

%Los valores del modelo se muestran a continuación:

%\begin{lstlisting}[language=R, caption= \textit{Método Holt-Winters aditivo}]
%Holt-Winters' additive method 
%
%Call:
% hw(y = tsData, h = 1, seasonal = "additive", level = c(q1, q2)) 
%
%  Smoothing parameters:
%    alpha = 0.1247 
%    beta  = 1 
%    gamma = 1 
%
%  Initial states:
%    l = 111 
%    b = -22.5 
%    s = -50 50
%
%  sigma:  155.8648
%\end{lstlisting}

%\begin{figure}[H]
%\centering
%\includegraphics[scale = 0.8]{modelo_HW_total_alumnos_x_sem} %width=\textwidth
%\caption{\textit{Modelo del método aditivo de Holt-Winters: Total de alumnos por semestre}}
%\end{figure}




